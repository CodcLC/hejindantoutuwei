{"version":3,"sources":["assets\\Script\\control\\joystick.js"],"names":["cc","Class","Component","properties","controlNode","type","Node","tooltip","stick","maxRadius","Float","isTouch","get","_isTouch","Boolean","dir","_dir","Vec2","onEnable","_onTouchEnd","on","EventType","TOUCH_START","_onTouchStart","TOUCH_MOVE","_onTouchMove","TOUCH_END","TOUCH_CANCEL","onDisable","off","e","_setStickPosition","pos","getLocation","jPos","node","convertToNodeSpaceAR","len","mag","x","y","setPosition","v2","start"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        controlNode: {\r\n            default: null,\r\n            type: cc.Node,\r\n            tooltip: \"可操作摇杆的节点（决定操作范围）\"\r\n        },\r\n        stick: {\r\n            default: null,\r\n            type: cc.Node,\r\n            tooltip: \"摇杆\"\r\n        },\r\n        maxRadius: {\r\n            default: 200,\r\n            type: cc.Float,\r\n            tooltip: \"摇杆最大移动半径\"\r\n        },\r\n        isTouch: {\r\n            get() {\r\n                return this._isTouch;\r\n            },\r\n            type: cc.Boolean,\r\n            tooltip: \"摇杆是否按下\"\r\n        },\r\n        dir: {\r\n            get() {\r\n                return this._dir;\r\n            },\r\n            type: cc.Vec2,\r\n            tooltip: \"摇杆向量\"\r\n        }\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n    // onLoad () {},\r\n    onEnable() {\r\n        this._onTouchEnd();\r\n        this.controlNode.on(cc.Node.EventType.TOUCH_START, this._onTouchStart, this);\r\n        this.controlNode.on(cc.Node.EventType.TOUCH_MOVE, this._onTouchMove, this);\r\n        this.controlNode.on(cc.Node.EventType.TOUCH_END, this._onTouchEnd, this);\r\n        this.controlNode.on(cc.Node.EventType.TOUCH_CANCEL, this._onTouchEnd, this);\r\n    },\r\n    onDisable() {\r\n        this._onTouchEnd();\r\n        this.controlNode.off(cc.Node.EventType.TOUCH_START, this._onTouchStart, this);\r\n        this.controlNode.off(cc.Node.EventType.TOUCH_MOVE, this._onTouchMove, this);\r\n        this.controlNode.off(cc.Node.EventType.TOUCH_END, this._onTouchEnd, this);\r\n        this.controlNode.off(cc.Node.EventType.TOUCH_CANCEL, this._onTouchEnd, this);\r\n    },\r\n    _onTouchStart(e) {\r\n        this._isTouch = true;\r\n        this._setStickPosition(e);\r\n    },\r\n    _onTouchMove(e) {\r\n        if (!this._isTouch)\r\n            return;\r\n        this._setStickPosition(e);\r\n    },\r\n    _setStickPosition(e) {\r\n        var pos = e.getLocation();\r\n        var jPos = this.node.convertToNodeSpaceAR(pos);\r\n        var len = jPos.mag();\r\n        // 设置摇杆的位置\r\n        if (len > this.maxRadius) {\r\n            jPos.x = this.maxRadius * jPos.x / len;\r\n            jPos.y = this.maxRadius * jPos.y / len;\r\n            len = this.maxRadius;\r\n        }\r\n        this._dir.x = jPos.x / this.maxRadius;\r\n        this._dir.y = jPos.y / this.maxRadius;\r\n        this.stick.setPosition(jPos);\r\n        if(len<50)return;\r\n\r\n\r\n\r\n\r\n    },\r\n    _onTouchEnd(e) {\r\n        this._isTouch = false;\r\n        // 初始化摇杆节点位置及角度\r\n        this.stick.setPosition(cc.v2(0, 0));\r\n        this._dir = cc.v2(0, 0);\r\n    },\r\n    start() {\r\n    }\r\n    // update (dt) {},\r\n});\r\n"]}