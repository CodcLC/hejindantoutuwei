{"version":3,"sources":["assets\\Script\\zhujie\\roleMove.js"],"names":["cc","Class","Component","properties","maxSpeed","jumps","jumpSpeed","drag","onLoad","_moveFlags","node","roleState","_up","body","getComponent","RigidBody","jumping","on","onKeyDown","onKeyUp","zIndex","_lastX","onDestroy","off","data","game","isOver","gameControl","left","gameAction","MOVE_LEFT","right","MOVE_RIGHT","up","_upPressed","down","weapons","emit","onBeginContact","contact","selfCollider","otherCollider","onEndContact","onPreSolve","onPostSolve","update","dt","speed","linearVelocity","x","Math","abs","y","setState","mapRect","width","value"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n    properties: {\n        maxSpeed: 300,//最大速度\n        jumps: 2, //跳跃次数\n        //acceleration: 1500,//加速度\n        jumpSpeed: 500, //跳跃速度\n        drag: 600       //拖拽速度\n    },\n    onLoad: function () {\n        this._moveFlags = 0;\n        this.node.roleState = this.roleState = 0;//角色状态  0=静止 1=移动 2=跳跃\n        this._up = false;\n        this.body = this.getComponent(cc.RigidBody);\n        this.jumping = false;\n        this.node.on(\"key_down\", this.onKeyDown, this);\n        this.node.on(\"key_up\", this.onKeyUp, this);\n        this.node.zIndex = 10;\n        this._lastX = 0;\n    },\n    onDestroy() {\n        this.node.off(\"key_down\", this.onKeyDown, this);\n        this.node.off(\"key_up\", this.onKeyUp, this);\n    },\n    onKeyDown(data) {\n        if (game.isOver) return;\n        switch (data) {\n            case game.gameControl.left:\n                this._moveFlags |= game.gameAction.MOVE_LEFT;\n                break;\n            case game.gameControl.right:\n                this._moveFlags |= game.gameAction.MOVE_RIGHT;\n                break;\n            case game.gameControl.up:\n                if (!this._upPressed) {\n                    this._up = true;\n                }\n                this._upPressed = true;\n                break;\n            case game.gameControl.down:\n                //this.node.emit(\"switchSkin\");//更改方向\n                break;\n            case game.gameControl.weapons:\n                this.node.emit(\"switchSkin\");//更改方向\n                break;\n        }\n    },\n    onKeyUp(data) {\n        if (game.isOver) return;\n        switch (data) {\n            case game.gameControl.left:\n                this._moveFlags &= ~game.gameAction.MOVE_LEFT;\n                break;\n            case game.gameControl.right:\n                this._moveFlags &= ~game.gameAction.MOVE_RIGHT;\n                break;\n            case game.gameControl.down:\n            case game.gameControl.up:\n                this._upPressed = false;\n                break;\n        }\n    },\n    // 只在两个碰撞体开始接触时被调用一次\n    onBeginContact: function (contact, selfCollider, otherCollider) {\n        this.jumping = false;\n    },\n    // 只在两个碰撞体结束接触时被调用一次\n    onEndContact: function (contact, selfCollider, otherCollider) {\n    },\n    // 每次将要处理碰撞体接触逻辑时被调用\n    onPreSolve: function (contact, selfCollider, otherCollider) {\n    },\n    // 每次处理完碰撞体接触逻辑时被调用\n    onPostSolve: function (contact, selfCollider, otherCollider) {\n    },\n    update: function (dt) {\n        if (game.isOver) return;\n        var speed = this.body.linearVelocity;\n        if (this._moveFlags === game.gameAction.MOVE_LEFT) {\n            // speed.x -= this.acceleration * dt;\n            // if (speed.x < -this.maxSpeed) {\n            //     speed.x = -this.maxSpeed;\n            // }\n            speed.x = -this.maxSpeed;\n            this.node.emit(\"changeDirection\", -1);//更改方向\n        }\n        else if (this._moveFlags === game.gameAction.MOVE_RIGHT) {\n            // speed.x += this.acceleration * dt;\n            // if (speed.x > this.maxSpeed) {\n            //     speed.x = this.maxSpeed;\n            // }\n            speed.x = this.maxSpeed;\n            this.node.emit(\"changeDirection\", 1);//更改方向\n        }\n        else {\n            // if (speed.x != 0) {\n            //     var d = this.drag * dt;\n            //     if (Math.abs(speed.x) <= d) {\n            //         speed.x = 0;\n            //     } else {\n            //         speed.x -= speed.x > 0 ? d : -d;\n            //     }\n            // }\n            speed.x = 0;\n        }\n        //  cc.log(speed.x,speed.y);\n        if (Math.abs(speed.y) < 1) {\n            this.jumps = 2;\n        }\n        if (this.jumps > 0 && this._up) {\n            speed.y = this.jumpSpeed;\n            this.jumps--;\n            this.setState(2);\n            this.jumping = true;\n        }\n        this._up = false;\n        if (this.jumping == false) {\n            if (speed.x > 0 || speed.x < 0) {\n                this.setState(1);\n            }\n            else {\n                this.setState(0);\n            }\n        }\n        if (speed.x != 0) {\n            if (speed.x < 0) {\n                if (this.node.x < (game.mapRect.x + 150)) {\n                    speed.x = 0;\n                }\n            }\n            else {\n                if (this.node.x > (game.mapRect.x + game.mapRect.width - 300)) {\n                    speed.x = 0;\n                }\n            }\n            if (speed.y == 0) {\n                speed.y = 10;\n            }\n        }\n        this._lastX = this.node.x;\n        this.body.linearVelocity = speed;\n    },\n    //设置角色状态\n    setState(value) {\n        if (this.roleState == value) return;\n        this.node.roleState = this.roleState = value;\n        this.node.emit(\"roleState\", this.roleState);//更改动作\n    },\n});\n"]}