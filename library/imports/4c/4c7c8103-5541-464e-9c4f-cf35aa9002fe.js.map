{"version":3,"sources":["assets\\Script\\enemy\\enemySend.js"],"names":["PoolComponent","require","cc","Class","properties","bulletName","parent","Node","sendNode","shootNum","unuse","shooting","shoot_num","off","shoot_start","shoot_end","reuse","data","_","clone","node","on","onCollisionEnter","other","self","isDeath","game","isOver","emit","onCollisionStay","shoot","onCollisionExit","onDestroy","onLoad","shootPos","convertToWorldSpaceAR","point1","targetPos","point2","angle","gameUtils","getRotation","scaleX","prefabName","v","group"],"mappings":"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","sourceRoot":"/","sourcesContent":["let PoolComponent = require(\"PoolComponent\")\r\ncc.Class({\r\n    extends: PoolComponent,\r\n    properties: {\r\n        bulletName: \"bullet1\",\r\n        parent: cc.Node,\r\n        sendNode: cc.Node,\r\n        shootNum: 5\r\n    },\r\n    unuse: function () {\r\n        this.shooting = false;\r\n        this.shoot_num = 0;\r\n        this.parent.off(\"shoot_start\", this.shoot_start, this);\r\n        this.parent.off(\"shoot_end\", this.shoot_end, this);\r\n    },\r\n    reuse: function (data) {\r\n        this.data = _.clone(data);\r\n        if (!this.parent) this.parent = this.node.parent;\r\n        this.parent.on(\"shoot_start\", this.shoot_start, this);\r\n        this.parent.on(\"shoot_end\", this.shoot_end, this);\r\n        this.shooting = false;\r\n        this.shoot_num = 0;\r\n    },\r\n    //碰撞进入\r\n    onCollisionEnter: function (other, self) {\r\n        if (this.parent.isDeath) return;\r\n        if (game.isOver) return;\r\n        this.shoot_num = 0;\r\n        if (this.shooting) {\r\n            this.parent.emit(\"collision_shoot_start\");\r\n        }\r\n    },\r\n    //碰撞停留\r\n    onCollisionStay: function (other, self) {\r\n        if (this.shooting) {\r\n            this.shoot_num++;\r\n            if (this.shoot_num >= this.shootNum) {\r\n                this.shoot();\r\n            }\r\n        }\r\n    },\r\n    //碰撞退出\r\n    onCollisionExit: function (other, self) {\r\n        this.shoot_num = 0;\r\n    },\r\n    //开始射击\r\n    shoot_start() {\r\n        this.shooting = true;\r\n    },\r\n    //射击动作结束\r\n    shoot_end() {\r\n        if (this.shooting) {\r\n            this.shoot();\r\n        }\r\n        // this.shooting = false;\r\n    },\r\n    //该方法为生命周期方法，父类未必会有实现。\r\n    onDestroy() {\r\n    },\r\n    onLoad() {\r\n    },\r\n    shoot() {\r\n        this.shooting = false;\r\n        var sendNode = this.sendNode || this.node;\r\n        let shootPos = sendNode.convertToWorldSpaceAR(game.point1);\r\n        let targetPos = sendNode.convertToWorldSpaceAR(game.point2);\r\n        let angle = game.gameUtils.getRotation(shootPos, targetPos);\r\n        if (this.node.scaleX < 0) {\r\n            angle = 360 - angle;\r\n        }\r\n        else {\r\n        }\r\n        // _.assignIn(this.data, {\r\n        this.data.prefabName = this.bulletName;//预制体名称\r\n        this.data.v = shootPos;//位置\r\n        this.data.angle = angle;//角度\r\n        this.data.group = \"enbull\"; //组\r\n        //prefabName\r\n        game.emit(\"shoot\", this.data);\r\n        this.parent.emit(\"collision_shoot_end\");\r\n        this.shoot_num = 0;\r\n    }\r\n});\r\n"]}