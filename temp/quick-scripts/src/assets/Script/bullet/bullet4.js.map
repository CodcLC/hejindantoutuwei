{"version":3,"sources":["assets\\Script\\bullet\\bullet4.js"],"names":["PoolComponent","require","cc","Class","properties","speed","fire","Animation","addSpeedY","range","onLoad","_lastPos","v2","_curPos","unuse","reuse","data","game","soundManager","playEffect","gameSound","qing_xing_qiang_jie4","emit","aniName","v","angle","init","idx","group","node","hd","Math","PI","speedX","cos","width","speedY","sin","x","y","curRange","_isinit","spriteFrames","gameUtils","getSpriteFrames","bullet_atlas","fireClip","AnimationClip","createWithSpriteFrames","name","wrapMode","WrapMode","Loop","addClip","play","state","active","start","onDestroy","onCollisionEnter","other","self","end","_","assign","pool","put","removeFromParent","destroy","update","dt","rotation","getRotation"],"mappings":"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","sourceRoot":"/","sourcesContent":["let PoolComponent = require(\"PoolComponent\"); //池子组件\r\ncc.Class({\r\n    extends: PoolComponent,\r\n    properties: {\r\n        speed: 500,\r\n        fire: cc.Animation,\r\n        addSpeedY: 100,\r\n        range: 2000,\r\n    },\r\n    onLoad() {\r\n        this._lastPos = cc.v2(0, 0);\r\n        this._curPos = cc.v2(0, 0);\r\n    },\r\n    //回收\r\n    unuse: function () {\r\n    },\r\n    //重用\r\n    reuse: function (data) {\r\n        game.soundManager.playEffect(game.gameSound.qing_xing_qiang_jie4, false);\r\n        this.data = data;\r\n        game.emit(\"shootFire\", {aniName: \"eff2\", v: data.v, angle: data.angle});//开火动画\r\n        this.init(data);\r\n    },\r\n    init(data) {\r\n        this.idx = 0;\r\n        if (data.group) this.node.group = data.group;\r\n        this.node.angle = data.angle;\r\n        let hd = this.node.angle * Math.PI / 180;\r\n        this.speedX = Math.cos(hd) * this.node.width / 2;\r\n        this.speedY = Math.sin(hd) * this.node.width / 2;\r\n        this.node.x = data.v.x + this.speedX;\r\n        this.node.y = data.v.y + this.speedY;\r\n        this.speedX = Math.cos(hd) * this.speed;\r\n        this.speedY = Math.sin(hd) * this.speed;\r\n        this.curRange = this.range;\r\n        //火焰动画\r\n        if (!this._isinit) {\r\n            let spriteFrames = game.gameUtils.getSpriteFrames(game.bullet_atlas, \"fire1\");\r\n            let fireClip = cc.AnimationClip.createWithSpriteFrames(spriteFrames, 30);\r\n            fireClip.name = 'fire';\r\n            fireClip.wrapMode = cc.WrapMode.Loop;\r\n            this.fire.addClip(fireClip);\r\n            this.fire.play('fire');\r\n        }\r\n        this.state = \"move\";\r\n        this.node.active = true;\r\n    },\r\n    start() {\r\n    },\r\n    onDestroy() {\r\n    },\r\n    //碰撞检测到\r\n    onCollisionEnter: function (other, self) {\r\n        this.end();\r\n    },\r\n    end() {\r\n        if (this.state == \"end\") return;\r\n        this.state = \"end\";\r\n        this.data = _.assign(this.data, {\r\n            aniName: \"bomb1\",//预制体名称\r\n            v: cc.v2(this.node.x, this.node.y), //位置\r\n            angle: 0,//角度\r\n            group: this.node.group //组\r\n        });\r\n        game.emit(\"bomb1\", this.data);//爆炸\r\n        let pool = this.node.pool;\r\n        if (pool) {\r\n            pool.put(this.node);\r\n        }\r\n        else {\r\n            this.node.removeFromParent(true);\r\n            this.node.destroy();\r\n        }\r\n    },\r\n    update(dt) {\r\n        if (this.state != \"move\") {\r\n            return;\r\n        }\r\n        // let hd = this.node.angle * Math.PI / 180;\r\n        // this.speedX = Math.cos(hd) * this.speed;\r\n        // this.speedY = Math.sin(hd) * this.speed;\r\n        //\r\n        this.idx++;\r\n        this.curRange -= this.speed * dt;\r\n        if (this.curRange <= 0) {\r\n            this.end();\r\n            return;\r\n        }\r\n        this._lastPos.x = this.node.x;\r\n        this._lastPos.y = this.node.y;\r\n        // let curPos = cc.v2(this.node.x, this.node.y);\r\n        this.speedY -= 9.8;\r\n        this.node.x += this.speedX * dt;\r\n        this.node.y += this.speedY * dt;\r\n        this._curPos.x = this.node.x;\r\n        this._curPos.y = this.node.y;\r\n        //let pos = cc.v2(this.node.x, this.node.y);\r\n        let rotation = game.gameUtils.getRotation(this._lastPos, this._curPos);\r\n        this.node.angle = rotation;\r\n    },\r\n});\r\n"]}