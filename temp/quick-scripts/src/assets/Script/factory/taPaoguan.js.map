{"version":3,"sources":["assets\\Script\\factory\\taPaoguan.js"],"names":["cc","Class","Component","properties","sendNode","Node","attackTme","attack","bulletName","onDestroy","parent","off","death","addEvent","on","node","getComponent","CircleCollider","enabled","renderComponents","getComponents","RenderComponent","renderComponent","setMaterial","game","materias","onLoad","targets","sendTime","worldPos","convertToWorldSpaceAR","v2","sx","scaleX","psy","flip","flip2","targetGroup","group","onCollisionEnter","other","self","isOver","isDeath","indexOf","push","onCollisionExit","idx","splice","start","update","dt","length","target","targetPos","point1","rotation","gameUtils","getRotation","angle","sendPos","emit","aniName","v","prefabName"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        sendNode: cc.Node,\r\n        attackTme: 1, //攻击时间\r\n        attack: 1000, //攻击力\r\n        bulletName: \"bullet5\"\r\n    },\r\n    onDestroy() {\r\n        this.parent.off(\"death\", this.death, this);\r\n    },\r\n    addEvent() {\r\n        this.parent.on(\"death\", this.death, this);\r\n    },\r\n    death() {\r\n        this.node.getComponent(cc.CircleCollider).enabled = false;\r\n        let renderComponents = this.node.getComponents(cc.RenderComponent);\r\n        let renderComponent = renderComponents[0];\r\n        renderComponent.setMaterial(0, game.materias[\"dissolve\"]);\r\n    },\r\n    onLoad() {\r\n        this.targets = [];\r\n        this.sendTime = 0;\r\n        this.parent = this.node.parent;\r\n        this.worldPos = this.node.convertToWorldSpaceAR(cc.v2(0, 0));\r\n        let sx = this.node.scaleX; //* this.parent.scaleX;\r\n        let psy = this.parent.scaleX; //* this.parent.scaleX;\r\n        sx = sx * psy;\r\n        this.flip = sx < 0;\r\n        this.flip2 = psy < 0;\r\n        this.targetGroup = \"enbull2\";\r\n        if (this.node.group == \"myeye\") {\r\n            this.targetGroup = \"mybull2\";\r\n        }\r\n        this.addEvent();\r\n    },\r\n    //碰撞进入\r\n    onCollisionEnter: function (other, self) {\r\n        if (game.isOver) return;\r\n        if (this.node.isDeath) return;\r\n        let node = other.node;\r\n        if (this.targets.indexOf(node) < 0) {\r\n            this.targets.push(node);\r\n        }\r\n    },\r\n    //碰撞退出\r\n    onCollisionExit: function (other, self) {\r\n        if (game.isOver) return;\r\n        if (this.parent.isDeath) return;\r\n        let node = other.node;\r\n        let idx = this.targets.indexOf(node)\r\n        if (idx >= 0) {\r\n            this.targets.splice(idx, 1);\r\n        }\r\n    },\r\n    start() {\r\n    },\r\n    update(dt) {\r\n        if (game.isOver) return;\r\n        if (this.parent.isDeath) return;\r\n        this.sendTime += dt;\r\n        if (!this.targets || this.targets.length == 0) {\r\n            //\r\n            //this.sendTime = 0;\r\n            return;\r\n        }\r\n        let target = this.targets[0];\r\n        let targetPos = target.convertToWorldSpaceAR(game.point1);\r\n        // game.root.emit(\"drawClear\");\r\n        // game.root.emit(\"draw\", targetPos);\r\n        //game.root.emit(\"draw\", this.worldPos);\r\n        let rotation = game.gameUtils.getRotation(this.worldPos, targetPos);\r\n        if (this.flip) {\r\n            rotation = rotation + 180;\r\n        }\r\n        if (this.flip2) {\r\n            rotation = 360 - rotation;\r\n        }\r\n        this.node.angle = rotation;// dt * 10;\r\n        if (this.sendTime > this.attackTme) //攻击时间到了\r\n        {\r\n            this.sendTime = 0;\r\n            let sendPos = this.sendNode.convertToWorldSpaceAR(game.point1);\r\n            rotation = game.gameUtils.getRotation(sendPos, targetPos);\r\n            //game.emit(\"shootFire\", \"fire\", \"eff3\", sendPos, rotation, this.targetGroup);//开火动画\r\n            game.emit(\"shootFire\", {aniName: \"eff3\", v: sendPos, angle: rotation});//开火动画\r\n            game.emit(\"shoot\", {\r\n                prefabName: this.bulletName,//预制体名称\r\n                v: sendPos, //位置\r\n                angle: rotation - 15,//角度\r\n                group: this.targetGroup, //组\r\n                attack: this.attack\r\n            });\r\n            game.emit(\"shoot\", {\r\n                prefabName: this.bulletName,//预制体名称\r\n                v: sendPos, //位置\r\n                angle: rotation,//角度\r\n                group: this.targetGroup, //组\r\n                attack: this.attack\r\n            });\r\n            game.emit(\"shoot\", {\r\n                prefabName: this.bulletName,//预制体名称\r\n                v: sendPos, //位置\r\n                angle: rotation + 15,//角度\r\n                group: this.targetGroup, //组\r\n                attack: this.attack\r\n            });\r\n        }\r\n    },\r\n});\r\n"]}