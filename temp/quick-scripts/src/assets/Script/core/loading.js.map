{"version":3,"sources":["assets\\Script\\core\\loading.js"],"names":["cc","Class","Component","properties","progressNode","Node","resLabel","Label","barLabel","onDestroy","onLoad","game","addPersistRootNode","node","zIndex","curScene","on","gameEvent","load_scene","loadScene","loader","onProgress","bind","completedCount","totalCount","active","uuids","require","scene","width","log","lastId","director","onCompleteScene","item","id","substring","lastIndexOf","url","progress","format","string","parseInt"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        progressNode: cc.Node, //进度条节点\r\n        resLabel: cc.Label,\r\n        barLabel: cc.Label\r\n    },\r\n    onDestroy() {\r\n    },\r\n    onLoad() {\r\n        cc.game.addPersistRootNode(this.node); //添加常驻节点\r\n        this.node.zIndex = 10;\r\n        game.curScene = this.curScene = \"login\";\r\n        game.on(game.gameEvent.load_scene, this.loadScene, this); //场景切换场景\r\n        cc.loader.onProgress = this.onProgress.bind(this);\r\n        this.completedCount = 0;\r\n        this.totalCount = 1;\r\n        this.node.active = false;\r\n        this.uuids = require(\"uuids\");\r\n    },\r\n    //开始切换场景\r\n    loadScene(scene) {\r\n        if (game.curScene == scene) return;\r\n        this.node.active = true;\r\n        game.curScene = this.curScene = scene;\r\n        if (this.progressNode)\r\n            this.progressNode.width = 0;\r\n        cc.log(\"切换场景\");\r\n        this.lastId = 0;\r\n        cc.director.loadScene(scene, this.onCompleteScene.bind(this)); //场景加载完成\r\n        //cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH, this.onCompleteScene.bind(this));\r\n        //this.isLoadingScene = true;\r\n    },\r\n    //加载完成\r\n    onCompleteScene: function () {\r\n        this.node.active = false;\r\n    },\r\n    //加载场景进度\r\n    onProgress(completedCount, totalCount, item) {\r\n        var id = item.id.substring(item.id.lastIndexOf('/') + 1, item.id.lastIndexOf(\".\"))\r\n        var url = this.uuids[id];\r\n        if (!url) {\r\n            return;\r\n        }\r\n        if (totalCount > 1) {\r\n            this.totalCount = totalCount;\r\n        }\r\n        this.completedCount = completedCount;\r\n        if (this.completedCount > this.totalCount) {\r\n            this.completedCount = this.totalCount;\r\n        }\r\n        var progress = (this.completedCount / this.totalCount).format(2);\r\n        if (this.progressNode)\r\n            this.progressNode.width = 1030 * progress;\r\n        if (this.barLabel)\r\n            this.barLabel.string = parseInt(progress * 100) + \"%\";\r\n        // if (this.resLabel)\r\n        //     this.resLabel.string = item.id || \"\";\r\n    }\r\n});\r\n"]}