{"version":3,"sources":["assets\\Script\\core\\popupLayer.js"],"names":["cc","Class","Component","properties","resLoader","Node","bg","onDestroy","onLoad","popopNodes","loadingList","childList","game","on","gameEvent","popup_prefab","closed_prefab","autoRes","node","self","poolComponents","getComponentsInChildren","i","poolComponent","unuse","parent","idx","indexOf","splice","showNodes","isPopup","cb","opacity","setScale","fadeIn","scaleTo","tween","then","call","bind","start","fadeOut","data","msg","loadPrefab","url","err","push","addChild","x","y","log","reuse","onComplete","opts","once","loader","loadRes","Prefab","prefab","instantiate","emit","length","zIndex","count","childrenCount","len","active","onClick","e"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        resLoader: cc.Node,//资源加载菊花圈\r\n        bg: cc.Node,\r\n    },\r\n    onDestroy() {\r\n    },\r\n    onLoad() {\r\n        //this.prefabs = game.gamePopup;\r\n        this.popopNodes = {};\r\n        this.loadingList = [];\r\n        this.childList = []; //添加的子节点列表\r\n        game.on(game.gameEvent.popup_prefab, this.popup_prefab, this);\r\n        game.on(game.gameEvent.closed_prefab, this.closed_prefab, this);\r\n        this.autoRes();\r\n    },\r\n    closed_prefab(node) {\r\n        var self = this;\r\n        let poolComponents = node.getComponentsInChildren(\"PoolComponent\");\r\n        for (let i in poolComponents) {\r\n            let poolComponent = poolComponents[i];\r\n            poolComponent.unuse(); //启用\r\n        }\r\n        // this.showNodes(node, false, function () {\r\n        //     this.parent = null;\r\n        //     var idx = self.childList.indexOf(this);\r\n        //     if (idx >= 0) {\r\n        //         self.childList.splice(idx, 1);\r\n        //     }\r\n        //     self.autoRes();\r\n        // }.bind(node));\r\n        node.parent = null;\r\n        let idx = self.childList.indexOf(node);\r\n        if (idx >= 0) {\r\n            self.childList.splice(idx, 1);\r\n        }\r\n        self.autoRes();\r\n    },\r\n    showNodes(node, isPopup, cb) {\r\n        if (node == null) {\r\n            return\r\n        }\r\n        if (isPopup == true) {\r\n            node.opacity = 0;\r\n            node.setScale(0.1);\r\n            let fadeIn = cc.fadeIn(0.2);\r\n            let scaleTo = cc.scaleTo(0.2, 1);\r\n            cc.tween(node).then(fadeIn).then(scaleTo).call(function () {\r\n                if (cb) cb();\r\n            }.bind(node)).start();\r\n        }\r\n        else {\r\n            node.opacity = 1;\r\n            node.setScale(1);\r\n            let fadeOut = cc.fadeOut(0.2);\r\n            let scaleTo = cc.scaleTo(0.2, 0.1);\r\n            cc.tween(node).then(fadeOut).then(scaleTo).call(function () {\r\n                if (cb) cb();\r\n            }.bind(node)).start();\r\n        }\r\n    },\r\n    popup_prefab(data, msg) {\r\n        // let date = this.prefabs[name];\r\n        // if (!date) {\r\n        //     console.log(\"\\\" %s \\\"弹窗模块未注册\", name);\r\n        //     alert(\"\\\" %s \\\"弹窗模块未注册\", name);\r\n        //     return;\r\n        // }\r\n        this.loadPrefab(data.url, function (err, node) {\r\n            if (!err) {\r\n                var idx = this.childList.indexOf(node);\r\n                if (idx >= 0) {\r\n                    this.childList.splice(idx, 1);\r\n                }\r\n                this.childList.push(node);\r\n                if (!node.parent) {\r\n                    this.node.addChild(node);\r\n                }\r\n                else {\r\n                    node.parent = this.node;\r\n                }\r\n                node.x = node.y = 0;\r\n                cc.log(node.x, node.y);\r\n                let poolComponents = node.getComponentsInChildren(\"PoolComponent\");\r\n                for (let i in poolComponents) {\r\n                    let poolComponent = poolComponents[i];\r\n                    poolComponent.reuse(msg); //启用\r\n                    poolComponent.onComplete(); //启用\r\n                }\r\n                // var self = this;\r\n                // this.showNodes(node, true, function () {\r\n                //     let poolComponents = this.getComponentsInChildren(\"PoolComponent\");\r\n                //     for (let i in poolComponents) {\r\n                //         let poolComponent = poolComponents[i];\r\n                //         poolComponent.onComplete(); //启用\r\n                //     }\r\n                //     self.autoRes();\r\n                // }.bind(node));\r\n            }\r\n            this.autoRes();\r\n        }.bind(this));\r\n        this.autoRes();\r\n    },\r\n    /*******\r\n     * 加载预制体\r\n     * *****/\r\n    loadPrefab: function (url, cb) {\r\n        if (this.popopNodes[url]) {\r\n            cb(null, this.popopNodes[url]);\r\n            return;\r\n        }\r\n        let opts = {\r\n            url: url,\r\n            cb: cb\r\n        };\r\n        let self = this;\r\n        if (this.loadingList.indexOf(url) >= 0) {\r\n            this.node.once(url, function (err, node) {\r\n                this.cb(err, node);\r\n            }.bind(opts));\r\n            return;\r\n        }\r\n        if (this.loadingList.indexOf(url) < 0) {\r\n            this.loadingList.push(url);\r\n        }\r\n        cc.loader.loadRes(url, cc.Prefab, function (err, prefab) {\r\n            let node\r\n            if (!err) {\r\n                node = cc.instantiate(prefab);\r\n                self.popopNodes[this.url] = node;\r\n            }\r\n            let idx = self.loadingList.indexOf(this.url);\r\n            if (idx >= 0) {\r\n                self.loadingList.splice(idx, 1);\r\n            }\r\n            this.cb(err, node);\r\n            self.node.emit(this.url, err, node);\r\n        }.bind(opts));\r\n    },\r\n    autoRes() {\r\n        for (var i = 0; i < this.childList.length; i++) {\r\n            var node = this.childList[i];\r\n            if (i == (this.childList.length - 1)) {\r\n                this.bg.zIndex = i;\r\n                node.zIndex = i + 1;\r\n            }\r\n            else {\r\n                node.zIndex = i;\r\n            }\r\n        }\r\n        let count = this.node.childrenCount;\r\n        var len = this.loadingList.length;\r\n        if (len > 0 || count > 1) {\r\n            this.node.active = true;\r\n        }\r\n        else {\r\n            this.node.active = false;\r\n        }\r\n        if (len > 0) {\r\n            this.resLoader.active = true;\r\n        }\r\n        else {\r\n            this.resLoader.active = false;\r\n        }\r\n    },\r\n    onClick(e) {\r\n    }\r\n})\r\n"]}