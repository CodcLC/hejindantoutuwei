{"version":3,"sources":["assets\\Script\\game\\soundManager.js"],"names":["module","exports","_musicUrl","_musicMute","_musicVolume","_effectList","_effectMute","_effectVolume","_curMusicId","init","musicMute","game","localStorage","getItem","effectMute","musicVolume","effectVolume","value","setItem","playMusic","cc","audioEngine","stopMusic","setMusicVolume","stopAllEffects","setEffectsVolume","url","loop","afresh","resources","load","AudioClip","err","clip","stop","bind","pauseMusic","resumeMusic","playEffect","checkEffect","loader","loadRes","id","setVolume","push","i","length","obj","getState","splice","stopEffect","stopAllEffect"],"mappings":"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","sourceRoot":"/","sourcesContent":["module.exports = {\r\n    _musicUrl: null,\r\n    _musicMute: false,\r\n    _musicVolume: 1,\r\n    _effectList: [],\r\n    _effectMute: false,\r\n    _effectVolume: 1,\r\n    _curMusicId: null,\r\n    init() {\r\n        let musicMute = game.localStorage.getItem(\"musicMute\");\r\n        if (musicMute == null) musicMute = false;\r\n        this.musicMute = musicMute;\r\n        let effectMute = game.localStorage.getItem(\"effectMute\");\r\n        if (effectMute == null) effectMute = false;\r\n        this.effectMute = effectMute;\r\n        let musicVolume = game.localStorage.getItem(\"musicVolume\");\r\n        if (musicVolume == null) musicVolume = 1;\r\n        this.musicVolume = musicVolume;\r\n        let effectVolume = game.localStorage.getItem(\"effectVolume\");\r\n        if (effectVolume == null) effectVolume = 1;\r\n        this.effectVolume = effectVolume;\r\n    },\r\n    /****\r\n     * 音乐是否静音\r\n     * ****/\r\n    get musicMute() {\r\n        return this._musicMute;\r\n    },\r\n    set musicMute(value) {\r\n        if (this._musicMute != value) {\r\n            game.localStorage.setItem(\"musicMute\", value);\r\n            this._musicMute = value;\r\n            if (!value)\r\n                this.playMusic(this._musicUrl, true, true);\r\n            else\r\n                cc.audioEngine.stopMusic();\r\n        }\r\n    },\r\n    /**背景音乐音量 */\r\n    get musicVolume() {\r\n        return this._musicVolume;\r\n    },\r\n    set musicVolume(value) {\r\n        if (this._musicVolume != value) {\r\n            game.localStorage.setItem(\"musicVolume\", value);\r\n            this._musicVolume = value;\r\n            cc.audioEngine.setMusicVolume(value);\r\n        }\r\n    },\r\n    /**音效是否静音 */\r\n    get effectMute() {\r\n        return this._effectMute;\r\n    },\r\n    set effectMute(value) {\r\n        if (this._effectMute != value) {\r\n            game.localStorage.setItem(\"effectMute\", value);\r\n            this._effectMute = value;\r\n            if (value)\r\n                cc.audioEngine.stopAllEffects();\r\n        }\r\n    },\r\n    /**音效音量 */\r\n    get effectVolume() {\r\n        return this._effectVolume;\r\n    },\r\n    set effectVolume(value) {\r\n        if (this._effectVolume != value) {\r\n            game.localStorage.setItem(\"effectVolume\", value);\r\n            this._effectVolume = value;\r\n            cc.audioEngine.setEffectsVolume(value);\r\n        }\r\n    },\r\n    /**\r\n     * 播放背景音乐\r\n     */\r\n    playMusic(url, loop, afresh) {\r\n        if (!afresh && this._musicUrl == url) return;\r\n        if (this._musicMute) return;\r\n        this._musicUrl = url;\r\n        cc.resources.load(url, cc.AudioClip, function (err, clip) {\r\n            \r\n            if (this._curMusicId) cc.audioEngine.stop(this._curMusicId);\r\n            this._curMusicId = cc.audioEngine.playMusic(clip, loop);\r\n        }.bind(this));\r\n    },\r\n    /**暂停播放背景音乐 */\r\n    pauseMusic() {\r\n        cc.audioEngine.pauseMusic();\r\n    },\r\n    /**继续播放背景音乐 */\r\n    resumeMusic() {\r\n        cc.audioEngine.resumeMusic();\r\n    },\r\n    /**停止背景音乐 */\r\n    stopMusic() {\r\n        cc.audioEngine.stopMusic();\r\n    },\r\n    /**\r\n     * 播放音效\r\n     * @param audioName 音乐文件名称，不需要填文件后缀\r\n     * @param loop 是否循环播放\r\n     * @param folder 资源文件夹名称，必须放在resources文件夹下面\r\n     */\r\n    playEffect(url, loop) {\r\n        loop = loop || false;\r\n        this.checkEffect();\r\n        if (this._effectMute) return;\r\n        cc.loader.loadRes(url, cc.AudioClip, function (err, clip) {\r\n            let id = cc.audioEngine.playEffect(clip, loop);\r\n            cc.audioEngine.setVolume(id, this.effectVolume);\r\n            this._effectList.push({\"url\": url, \"id\": id});\r\n        }.bind(this));\r\n    },\r\n    checkEffect() {\r\n        for (let i = this._effectList.length - 1; i >= 0; i--) {\r\n            let obj = this._effectList[i];\r\n            if (cc.audioEngine.getState(obj[\"id\"]) == -1)\r\n                this._effectList.splice(i, 1);\r\n        }\r\n    },\r\n    /**\r\n     * 停止某个音效\r\n     * @param audioName\r\n     * @param folder\r\n     */\r\n    stopEffect(url) {\r\n        for (let i = this._effectList.length - 1; i >= 0; i--) {\r\n            let obj = this._effectList[i];\r\n            if (cc.audioEngine.getState(obj[\"id\"]) == -1) {\r\n                this._effectList.splice(i, 1);\r\n                continue;\r\n            }\r\n            if (obj[\"url\"] == url) {\r\n                cc.audioEngine.stopEffect(obj[\"id\"]);\r\n                this._effectList.splice(i, 1);\r\n            }\r\n        }\r\n    },\r\n    /**停止所有音效 */\r\n    stopAllEffect() {\r\n        cc.audioEngine.stopAllEffects();\r\n        this._effectList.length = 0;\r\n    }\r\n};"]}