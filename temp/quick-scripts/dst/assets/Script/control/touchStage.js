
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/control/touchStage.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '3c1555LOtlIWJpD/YBmMkdZ', 'touchStage');
// Script/control/touchStage.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    canvas: cc.Node
  },
  onLoad: function onLoad() {
    game.touchDown = false;
    this.node.on(cc.Node.EventType.TOUCH_START, this.on_touch_start, this);
    this.node.on(cc.Node.EventType.TOUCH_END, this.on_touch_end, this);

    if (cc.sys.os == cc.sys.OS_ANDROID || cc.sys.os == cc.sys.OS_IOS) {
      //ANDROID IOS
      this.node.on(cc.Node.EventType.TOUCH_MOVE, this.on_touch_move, this);
    } else {
      this.node.on(cc.Node.EventType.TOUCH_MOVE, this.on_touch_move, this); //this.node.on(cc.Node.EventType.MOUSE_MOVE, this.on_mouse_move, this);
    }

    this.touchPos = cc.v2();
  },
  onDestroy: function onDestroy() {
    this.node.off(cc.Node.EventType.TOUCH_START, this.on_touch_start, this);
    this.node.off(cc.Node.EventType.TOUCH_END, this.on_touch_end, this);

    if (cc.sys.os == cc.sys.OS_ANDROID || cc.sys.os == cc.sys.OS_IOS) {
      //ANDROID IOS
      this.node.off(cc.Node.EventType.TOUCH_MOVE, this.on_touch_move, this);
    } else {
      this.node.off(cc.Node.EventType.TOUCH_MOVE, this.on_touch_move, this); //this.node.off(cc.Node.EventType.MOUSE_MOVE, this.on_mouse_move, this);
    }
  },
  //屏幕按下
  on_touch_start: function on_touch_start(touch) {
    var pos = touch.getLocation();
    var pos1 = this.node.convertToNodeSpaceAR(pos);
    this.touchPos.x = pos1.x + this.canvas.x;
    this.touchPos.y = pos1.y + this.canvas.y;
    game.emit("stage.touch", this.touchPos);
    game.touchDown = true;
  },
  on_touch_end: function on_touch_end(touch) {
    game.touchDown = false;
  },
  on_mouse_move: function on_mouse_move(touch) {
    var pos = touch.getLocation();
    var pos1 = this.node.convertToNodeSpaceAR(pos);
    this.touchPos.x = pos1.x + this.canvas.x;
    this.touchPos.y = pos1.y + this.canvas.y;
    game.emit("stage.touch", this.touchPos);
  },
  on_touch_move: function on_touch_move(touch) {
    var pos = touch.getLocation();
    var pos1 = this.node.convertToNodeSpaceAR(pos);
    this.touchPos.x = pos1.x + this.canvas.x;
    this.touchPos.y = pos1.y + this.canvas.y;
    game.emit("stage.touch", this.touchPos);
  },
  start: function start() {} // update (dt) {},

});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxjb250cm9sXFx0b3VjaFN0YWdlLmpzIl0sIm5hbWVzIjpbImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwiY2FudmFzIiwiTm9kZSIsIm9uTG9hZCIsImdhbWUiLCJ0b3VjaERvd24iLCJub2RlIiwib24iLCJFdmVudFR5cGUiLCJUT1VDSF9TVEFSVCIsIm9uX3RvdWNoX3N0YXJ0IiwiVE9VQ0hfRU5EIiwib25fdG91Y2hfZW5kIiwic3lzIiwib3MiLCJPU19BTkRST0lEIiwiT1NfSU9TIiwiVE9VQ0hfTU9WRSIsIm9uX3RvdWNoX21vdmUiLCJ0b3VjaFBvcyIsInYyIiwib25EZXN0cm95Iiwib2ZmIiwidG91Y2giLCJwb3MiLCJnZXRMb2NhdGlvbiIsInBvczEiLCJjb252ZXJ0VG9Ob2RlU3BhY2VBUiIsIngiLCJ5IiwiZW1pdCIsIm9uX21vdXNlX21vdmUiLCJzdGFydCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQUEsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDTCxhQUFTRCxFQUFFLENBQUNFLFNBRFA7QUFFTEMsRUFBQUEsVUFBVSxFQUFFO0FBQ1JDLElBQUFBLE1BQU0sRUFBRUosRUFBRSxDQUFDSztBQURILEdBRlA7QUFLTEMsRUFBQUEsTUFMSyxvQkFLSTtBQUNMQyxJQUFBQSxJQUFJLENBQUNDLFNBQUwsR0FBaUIsS0FBakI7QUFDQSxTQUFLQyxJQUFMLENBQVVDLEVBQVYsQ0FBYVYsRUFBRSxDQUFDSyxJQUFILENBQVFNLFNBQVIsQ0FBa0JDLFdBQS9CLEVBQTRDLEtBQUtDLGNBQWpELEVBQWlFLElBQWpFO0FBQ0EsU0FBS0osSUFBTCxDQUFVQyxFQUFWLENBQWFWLEVBQUUsQ0FBQ0ssSUFBSCxDQUFRTSxTQUFSLENBQWtCRyxTQUEvQixFQUEwQyxLQUFLQyxZQUEvQyxFQUE2RCxJQUE3RDs7QUFDQSxRQUFJZixFQUFFLENBQUNnQixHQUFILENBQU9DLEVBQVAsSUFBYWpCLEVB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LFNBQUtULFFBQUwsQ0FBY1UsQ0FBZCxHQUFtQkgsSUFBSSxDQUFDRyxDQUFMLEdBQVMsS0FBSzVCLE1BQUwsQ0FBWTRCLENBQXhDO0FBQ0F6QixJQUFBQSxJQUFJLENBQUMwQixJQUFMLENBQVUsYUFBVixFQUF5QixLQUFLWCxRQUE5QjtBQUNILEdBN0NJO0FBOENMRCxFQUFBQSxhQTlDSyx5QkE4Q1NLLEtBOUNULEVBOENnQjtBQUNqQixRQUFJQyxHQUFHLEdBQUdELEtBQUssQ0FBQ0UsV0FBTixFQUFWO0FBQ0EsUUFBSUMsSUFBSSxHQUFHLEtBQUtwQixJQUFMLENBQVVxQixvQkFBVixDQUErQkgsR0FBL0IsQ0FBWDtBQUNBLFNBQUtMLFFBQUwsQ0FBY1MsQ0FBZCxHQUFtQkYsSUFBSSxDQUFDRSxDQUFMLEdBQVMsS0FBSzNCLE1BQUwsQ0FBWTJCLENBQXhDO0FBQ0EsU0FBS1QsUUFBTCxDQUFjVSxDQUFkLEdBQW1CSCxJQUFJLENBQUNHLENBQUwsR0FBUyxLQUFLNUIsTUFBTCxDQUFZNEIsQ0FBeEM7QUFDQXpCLElBQUFBLElBQUksQ0FBQzBCLElBQUwsQ0FBVSxhQUFWLEVBQXlCLEtBQUtYLFFBQTlCO0FBQ0gsR0FwREk7QUFxRExhLEVBQUFBLEtBckRLLG1CQXFERyxDQUNQLENBdERJLENBdURMOztBQXZESyxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJjYy5DbGFzcyh7XHJcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgY2FudmFzOiBjYy5Ob2RlXHJcbiAgICB9LFxyXG4gICAgb25Mb2FkKCkge1xyXG4gICAgICAgIGdhbWUudG91Y2hEb3duID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX1NUQVJULCB0aGlzLm9uX3RvdWNoX3N0YXJ0LCB0aGlzKTtcclxuICAgICAgICB0aGlzLm5vZGUub24oY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfRU5ELCB0aGlzLm9uX3RvdWNoX2VuZCwgdGhpcyk7XHJcbiAgICAgICAgaWYgKGNjLnN5cy5vcyA9PSBjYy5zeXMuT1NfQU5EUk9JRCB8fCBjYy5zeXMub3MgPT0gY2Muc3lzLk9TX0lPUykgeyAvL0FORFJPSUQgSU9TXHJcbiAgICAgICAgICAgIHRoaXMubm9kZS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9NT1ZFLCB0aGlzLm9uX3RvdWNoX21vdmUsIHRoaXMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9NT1ZFLCB0aGlzLm9uX3RvdWNoX21vdmUsIHRoaXMpO1xyXG4gICAgICAgICAgICAvL3RoaXMubm9kZS5vbihjYy5Ob2RlLkV2ZW50VHlwZS5NT1VTRV9NT1ZFLCB0aGlzLm9uX21vdXNlX21vdmUsIHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnRvdWNoUG9zID0gY2MudjIoKTtcclxuICAgIH0sXHJcbiAgICBvbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgdGhpcy5ub2RlLm9mZihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9TVEFSVCwgdGhpcy5vbl90b3VjaF9zdGFydCwgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5ub2RlLm9mZihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9FTkQsIHRoaXMub25fdG91Y2hfZW5kLCB0aGlzKTtcclxuICAgICAgICBpZiAoY2Muc3lzLm9zID09IGNjLnN5cy5PU19BTkRST0lEIHx8IGNjLnN5cy5vcyA9PSBjYy5zeXMuT1NfSU9TKSB7IC8vQU5EUk9JRCBJT1NcclxuICAgICAgICAgICAgdGhpcy5ub2RlLm9mZihjYy5Ob2RlLkV2ZW50VHlwZS5UT1VDSF9NT1ZFLCB0aGlzLm9uX3RvdWNoX21vdmUsIHRoaXMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZS5vZmYoY2MuTm9kZS5FdmVudFR5cGUuVE9VQ0hfTU9WRSwgdGhpcy5vbl90b3VjaF9tb3ZlLCB0aGlzKTtcclxuICAgICAgICAgICAgLy90aGlzLm5vZGUub2ZmKGNjLk5vZGUuRXZlbnRUeXBlLk1PVVNFX01PVkUsIHRoaXMub25fbW91c2VfbW92ZSwgdGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIC8v5bGP5bmV5oyJ5LiLXHJcbiAgICBvbl90b3VjaF9zdGFydCh0b3VjaCkge1xyXG4gICAgICAgIHZhciBwb3MgPSB0b3VjaC5nZXRMb2NhdGlvbigpO1xyXG4gICAgICAgIHZhciBwb3MxID0gdGhpcy5ub2RlLmNvbnZlcnRUb05vZGVTcGFjZUFSKHBvcyk7XHJcbiAgICAgICAgdGhpcy50b3VjaFBvcy54ID0gKHBvczEueCArIHRoaXMuY2FudmFzLngpO1xyXG4gICAgICAgIHRoaXMudG91Y2hQb3MueSA9IChwb3MxLnkgKyB0aGlzLmNhbnZhcy55KTtcclxuICAgICAgICBnYW1lLmVtaXQoXCJzdGFnZS50b3VjaFwiLCB0aGlzLnRvdWNoUG9zKTtcclxuICAgICAgICBnYW1lLnRvdWNoRG93biA9IHRydWU7XHJcbiAgICB9LFxyXG4gICAgb25fdG91Y2hfZW5kKHRvdWNoKSB7XHJcbiAgICAgICAgZ2FtZS50b3VjaERvd24gPSBmYWxzZTtcclxuICAgIH0sXHJcbiAgICBvbl9tb3VzZV9tb3ZlKHRvdWNoKSB7XHJcbiAgICAgICAgdmFyIHBvcyA9IHRvdWNoLmdldExvY2F0aW9uKCk7XHJcbiAgICAgICAgdmFyIHBvczEgPSB0aGlzLm5vZGUuY29udmVydFRvTm9kZVNwYWNlQVIocG9zKTtcclxuICAgICAgICB0aGlzLnRvdWNoUG9zLnggPSAocG9zMS54ICsgdGhpcy5jYW52YXMueCk7XHJcbiAgICAgICAgdGhpcy50b3VjaFBvcy55ID0gKHBvczEueSArIHRoaXMuY2FudmFzLnkpO1xyXG4gICAgICAgIGdhbWUuZW1pdChcInN0YWdlLnRvdWNoXCIsIHRoaXMudG91Y2hQb3MpO1xyXG4gICAgfSxcclxuICAgIG9uX3RvdWNoX21vdmUodG91Y2gpIHtcclxuICAgICAgICB2YXIgcG9zID0gdG91Y2guZ2V0TG9jYXRpb24oKTtcclxuICAgICAgICB2YXIgcG9zMSA9IHRoaXMubm9kZS5jb252ZXJ0VG9Ob2RlU3BhY2VBUihwb3MpO1xyXG4gICAgICAgIHRoaXMudG91Y2hQb3MueCA9IChwb3MxLnggKyB0aGlzLmNhbnZhcy54KTtcclxuICAgICAgICB0aGlzLnRvdWNoUG9zLnkgPSAocG9zMS55ICsgdGhpcy5jYW52YXMueSk7XHJcbiAgICAgICAgZ2FtZS5lbWl0KFwic3RhZ2UudG91Y2hcIiwgdGhpcy50b3VjaFBvcyk7XHJcbiAgICB9LFxyXG4gICAgc3RhcnQoKSB7XHJcbiAgICB9LFxyXG4gICAgLy8gdXBkYXRlIChkdCkge30sXHJcbn0pO1xyXG4iXX0=