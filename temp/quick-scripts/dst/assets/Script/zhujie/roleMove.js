
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/zhujie/roleMove.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '6fc86RgnPlPjLOL8x/OVTmI', 'roleMove');
// Script/zhujie/roleMove.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    maxSpeed: 300,
    //最大速度
    jumps: 2,
    //跳跃次数
    //acceleration: 1500,//加速度
    jumpSpeed: 500,
    //跳跃速度
    drag: 600 //拖拽速度

  },
  onLoad: function onLoad() {
    this._moveFlags = 0;
    this.node.roleState = this.roleState = 0; //角色状态  0=静止 1=移动 2=跳跃

    this._up = false;
    this.body = this.getComponent(cc.RigidBody);
    this.jumping = false;
    this.node.on("key_down", this.onKeyDown, this);
    this.node.on("key_up", this.onKeyUp, this);
    this.node.zIndex = 10;
    this._lastX = 0;
  },
  onDestroy: function onDestroy() {
    this.node.off("key_down", this.onKeyDown, this);
    this.node.off("key_up", this.onKeyUp, this);
  },
  onKeyDown: function onKeyDown(data) {
    if (game.isOver) return;

    switch (data) {
      case game.gameControl.left:
        this._moveFlags |= game.gameAction.MOVE_LEFT;
        break;

      case game.gameControl.right:
        this._moveFlags |= game.gameAction.MOVE_RIGHT;
        break;

      case game.gameControl.up:
        if (!this._upPressed) {
          this._up = true;
        }

        this._upPressed = true;
        break;

      case game.gameControl.down:
        //this.node.emit("switchSkin");//更改方向
        break;

      case game.gameControl.weapons:
        this.node.emit("switchSkin"); //更改方向

        break;
    }
  },
  onKeyUp: function onKeyUp(data) {
    if (game.isOver) return;

    switch (data) {
      case game.gameControl.left:
        this._moveFlags &= ~game.gameAction.MOVE_LEFT;
        break;

      case game.gameControl.right:
        this._moveFlags &= ~game.gameAction.MOVE_RIGHT;
        break;

      case game.gameControl.down:
      case game.gameControl.up:
        this._upPressed = false;
        break;
    }
  },
  // 只在两个碰撞体开始接触时被调用一次
  onBeginContact: function onBeginContact(contact, selfCollider, otherCollider) {
    this.jumping = false;
  },
  // 只在两个碰撞体结束接触时被调用一次
  onEndContact: function onEndContact(contact, selfCollider, otherCollider) {},
  // 每次将要处理碰撞体接触逻辑时被调用
  onPreSolve: function onPreSolve(contact, selfCollider, otherCollider) {},
  // 每次处理完碰撞体接触逻辑时被调用
  onPostSolve: function onPostSolve(contact, selfCollider, otherCollider) {},
  update: function update(dt) {
    if (game.isOver) return;
    var speed = this.body.linearVelocity;

    if (this._moveFlags === game.gameAction.MOVE_LEFT) {
      // speed.x -= this.acceleration * dt;
      // if (speed.x < -this.maxSpeed) {
      //     speed.x = -this.maxSpeed;
      // }
      speed.x = -this.maxSpeed;
      this.node.emit("changeDirection", -1); //更改方向
    } else if (this._moveFlags === game.gameAction.MOVE_RIGHT) {
      // speed.x += this.acceleration * dt;
      // if (speed.x > this.maxSpeed) {
      //     speed.x = this.maxSpeed;
      // }
      speed.x = this.maxSpeed;
      this.node.emit("changeDirection", 1); //更改方向
    } else {
      // if (speed.x != 0) {
      //     var d = this.drag * dt;
      //     if (Math.abs(speed.x) <= d) {
      //         speed.x = 0;
      //     } else {
      //         speed.x -= speed.x > 0 ? d : -d;
      //     }
      // }
      speed.x = 0;
    } //  cc.log(speed.x,speed.y);


    if (Math.abs(speed.y) < 1) {
      this.jumps = 2;
    }

    if (this.jumps > 0 && this._up) {
      speed.y = this.jumpSpeed;
      this.jumps--;
      this.setState(2);
      this.jumping = true;
    }

    this._up = false;

    if (this.jumping == false) {
      if (speed.x > 0 || speed.x < 0) {
        this.setState(1);
      } else {
        this.setState(0);
      }
    }

    if (speed.x != 0) {
      if (speed.x < 0) {
        if (this.node.x < game.mapRect.x + 150) {
          speed.x = 0;
        }
      } else {
        if (this.node.x > game.mapRect.x + game.mapRect.width - 300) {
          speed.x = 0;
        }
      }

      if (speed.y == 0) {
        speed.y = 10;
      }
    }

    this._lastX = this.node.x;
    this.body.linearVelocity = speed;
  },
  //设置角色状态
  setState: function setState(value) {
    if (this.roleState == value) return;
    this.node.roleState = this.roleState = value;
    this.node.emit("roleState", this.roleState); //更改动作
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFx6aHVqaWVcXHJvbGVNb3ZlLmpzIl0sIm5hbWVzIjpbImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwibWF4U3BlZWQiLCJqdW1wcyIsImp1bXBTcGVlZCIsImRyYWciLCJvbkxvYWQiLCJfbW92ZUZsYWdzIiwibm9kZSIsInJvbGVTdGF0ZSIsIl91cCIsImJvZHkiLCJnZXRDb21wb25lbnQiLCJSaWdpZEJvZHkiLCJqdW1waW5nIiwib24iLCJvbktleURvd24iLCJvbktleVVwIiwiekluZGV4IiwiX2xhc3RYIiwib25EZXN0cm95Iiwib2ZmIiwiZGF0YSIsImdhbWUiLCJpc092ZXIiLCJnYW1lQ29udHJvbCIsImxlZnQiLCJnYW1lQWN0aW9uIiwiTU9WRV9MRUZUIiwicmlnaHQiLCJNT1ZFX1JJR0hUIiwidXAiLCJfdXBQcmVzc2VkIiwiZG93biIsIndlYXBvbnMiLCJlbWl0Iiwib25CZWdpbkNvbnRhY3QiLCJjb250YWN0Iiwic2VsZkNvbGxpZGVyIiwib3RoZXJDb2xsaWRlciIsIm9uRW5kQ29udGFjdCIsIm9uUHJlU29sdmUiLCJvblBvc3RTb2x2ZSIsInVwZGF0ZSIsImR0Iiwic3BlZWQiLCJsaW5lYXJWZWxvY2l0eSIsIngiLCJNYXRoIiwiYWJzIiwieSIsInNldFN0YXRlIiwibWFwUmVjdCIsIndpZHRoIiwidmFsdWUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBRUxDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxRQUFRLEVBQUUsR0FERjtBQUNNO0FBQ2RDLElBQUFBLEtBQUssRUFBRSxDQUZDO0FBRUU7QUFDVjtBQUNBQyxJQUFBQSxTQUFTLEVBQUUsR0FKSDtBQUlRO0FBQ2hCQyxJQUFBQSxJQUFJLEVBQUUsR0FMRSxDQUtROztBQUxSLEdBRlA7QUFTTEMsRUFBQUEsTUFBTSxF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UUFBQUEsS0FBSyxDQUFDSyxDQUFOLEdBQVUsRUFBVjtBQUNIO0FBQ0o7O0FBQ0QsU0FBSy9CLE1BQUwsR0FBYyxLQUFLWCxJQUFMLENBQVV1QyxDQUF4QjtBQUNBLFNBQUtwQyxJQUFMLENBQVVtQyxjQUFWLEdBQTJCRCxLQUEzQjtBQUNILEdBN0lJO0FBOElMO0FBQ0FNLEVBQUFBLFFBL0lLLG9CQStJSUcsS0EvSUosRUErSVc7QUFDWixRQUFJLEtBQUs3QyxTQUFMLElBQWtCNkMsS0FBdEIsRUFBNkI7QUFDN0IsU0FBSzlDLElBQUwsQ0FBVUMsU0FBVixHQUFzQixLQUFLQSxTQUFMLEdBQWlCNkMsS0FBdkM7QUFDQSxTQUFLOUMsSUFBTCxDQUFVMkIsSUFBVixDQUFlLFdBQWYsRUFBNEIsS0FBSzFCLFNBQWpDLEVBSFksQ0FHZ0M7QUFDL0M7QUFuSkksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIG1heFNwZWVkOiAzMDAsLy/mnIDlpKfpgJ/luqZcbiAgICAgICAganVtcHM6IDIsIC8v6Lez6LeD5qyh5pWwXG4gICAgICAgIC8vYWNjZWxlcmF0aW9uOiAxNTAwLC8v5Yqg6YCf5bqmXG4gICAgICAgIGp1bXBTcGVlZDogNTAwLCAvL+i3s+i3g+mAn+W6plxuICAgICAgICBkcmFnOiA2MDAgICAgICAgLy/mi5bmi73pgJ/luqZcbiAgICB9LFxuICAgIG9uTG9hZDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9tb3ZlRmxhZ3MgPSAwO1xuICAgICAgICB0aGlzLm5vZGUucm9sZVN0YXRlID0gdGhpcy5yb2xlU3RhdGUgPSAwOy8v6KeS6Imy54q25oCBICAwPemdmeatoiAxPeenu+WKqCAyPei3s+i3g1xuICAgICAgICB0aGlzLl91cCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmJvZHkgPSB0aGlzLmdldENvbXBvbmVudChjYy5SaWdpZEJvZHkpO1xuICAgICAgICB0aGlzLmp1bXBpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5ub2RlLm9uKFwia2V5X2Rvd25cIiwgdGhpcy5vbktleURvd24sIHRoaXMpO1xuICAgICAgICB0aGlzLm5vZGUub24oXCJrZXlfdXBcIiwgdGhpcy5vbktleVVwLCB0aGlzKTtcbiAgICAgICAgdGhpcy5ub2RlLnpJbmRleCA9IDEwO1xuICAgICAgICB0aGlzLl9sYXN0WCA9IDA7XG4gICAgfSxcbiAgICBvbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMubm9kZS5vZmYoXCJrZXlfZG93blwiLCB0aGlzLm9uS2V5RG93biwgdGhpcyk7XG4gICAgICAgIHRoaXMubm9kZS5vZmYoXCJrZXlfdXBcIiwgdGhpcy5vbktleVVwLCB0aGlzKTtcbiAgICB9LFxuICAgIG9uS2V5RG93bihkYXRhKSB7XG4gICAgICAgIGlmIChnYW1lLmlzT3ZlcikgcmV0dXJuO1xuICAgICAgICBzd2l0Y2ggKGRhdGEpIHtcbiAgICAgICAgICAgIGNhc2UgZ2FtZS5nYW1lQ29udHJvbC5sZWZ0OlxuICAgICAgICAgICAgICAgIHRoaXMuX21vdmVGbGFncyB8PSBnYW1lLmdhbWVBY3Rpb24uTU9WRV9MRUZUO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBnYW1lLmdhbWVDb250cm9sLnJpZ2h0OlxuICAgICAgICAgICAgICAgIHRoaXMuX21vdmVGbGFncyB8PSBnYW1lLmdhbWVBY3Rpb24uTU9WRV9SSUdIVDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgZ2FtZS5nYW1lQ29udHJvbC51cDpcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3VwUHJlc3NlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl91cCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX3VwUHJlc3NlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIGdhbWUuZ2FtZUNvbnRyb2wuZG93bjpcbiAgICAgICAgICAgICAgICAvL3RoaXMubm9kZS5lbWl0KFwic3dpdGNoU2tpblwiKTsvL+abtOaUueaWueWQkVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBnYW1lLmdhbWVDb250cm9sLndlYXBvbnM6XG4gICAgICAgICAgICAgICAgdGhpcy5ub2RlLmVtaXQoXCJzd2l0Y2hTa2luXCIpOy8v5pu05pS55pa55ZCRXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uS2V5VXAoZGF0YSkge1xuICAgICAgICBpZiAoZ2FtZS5pc092ZXIpIHJldHVybjtcbiAgICAgICAgc3dpdGNoIChkYXRhKSB7XG4gICAgICAgICAgICBjYXNlIGdhbWUuZ2FtZUNvbnRyb2wubGVmdDpcbiAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlRmxhZ3MgJj0gfmdhbWUuZ2FtZUFjdGlvbi5NT1ZFX0xFRlQ7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIGdhbWUuZ2FtZUNvbnRyb2wucmlnaHQ6XG4gICAgICAgICAgICAgICAgdGhpcy5fbW92ZUZsYWdzICY9IH5nYW1lLmdhbWVBY3Rpb24uTU9WRV9SSUdIVDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgZ2FtZS5nYW1lQ29udHJvbC5kb3duOlxuICAgICAgICAgICAgY2FzZSBnYW1lLmdhbWVDb250cm9sLnVwOlxuICAgICAgICAgICAgICAgIHRoaXMuX3VwUHJlc3NlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfSxcbiAgICAvLyDlj6rlnKjkuKTkuKrnorDmkp7kvZPlvIDlp4vmjqXop6bml7booqvosIPnlKjkuIDmrKFcbiAgICBvbkJlZ2luQ29udGFjdDogZnVuY3Rpb24gKGNvbnRhY3QsIHNlbGZDb2xsaWRlciwgb3RoZXJDb2xsaWRlcikge1xuICAgICAgICB0aGlzLmp1bXBpbmcgPSBmYWxzZTtcbiAgICB9LFxuICAgIC8vIOWPquWcqOS4pOS4queisOaSnuS9k+e7k+adn+aOpeinpuaXtuiiq+iwg+eUqOS4gOasoVxuICAgIG9uRW5kQ29udGFjdDogZnVuY3Rpb24gKGNvbnRhY3QsIHNlbGZDb2xsaWRlciwgb3RoZXJDb2xsaWRlcikge1xuICAgIH0sXG4gICAgLy8g5q+P5qyh5bCG6KaB5aSE55CG56Kw5pKe5L2T5o6l6Kem6YC76L6R5pe26KKr6LCD55SoXG4gICAgb25QcmVTb2x2ZTogZnVuY3Rpb24gKGNvbnRhY3QsIHNlbGZDb2xsaWRlciwgb3RoZXJDb2xsaWRlcikge1xuICAgIH0sXG4gICAgLy8g5q+P5qyh5aSE55CG5a6M56Kw5pKe5L2T5o6l6Kem6YC76L6R5pe26KKr6LCD55SoXG4gICAgb25Qb3N0U29sdmU6IGZ1bmN0aW9uIChjb250YWN0LCBzZWxmQ29sbGlkZXIsIG90aGVyQ29sbGlkZXIpIHtcbiAgICB9LFxuICAgIHVwZGF0ZTogZnVuY3Rpb24gKGR0KSB7XG4gICAgICAgIGlmIChnYW1lLmlzT3ZlcikgcmV0dXJuO1xuICAgICAgICB2YXIgc3BlZWQgPSB0aGlzLmJvZHkubGluZWFyVmVsb2NpdHk7XG4gICAgICAgIGlmICh0aGlzLl9tb3ZlRmxhZ3MgPT09IGdhbWUuZ2FtZUFjdGlvbi5NT1ZFX0xFRlQpIHtcbiAgICAgICAgICAgIC8vIHNwZWVkLnggLT0gdGhpcy5hY2NlbGVyYXRpb24gKiBkdDtcbiAgICAgICAgICAgIC8vIGlmIChzcGVlZC54IDwgLXRoaXMubWF4U3BlZWQpIHtcbiAgICAgICAgICAgIC8vICAgICBzcGVlZC54ID0gLXRoaXMubWF4U3BlZWQ7XG4gICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICBzcGVlZC54ID0gLXRoaXMubWF4U3BlZWQ7XG4gICAgICAgICAgICB0aGlzLm5vZGUuZW1pdChcImNoYW5nZURpcmVjdGlvblwiLCAtMSk7Ly/mm7TmlLnmlrnlkJFcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLl9tb3ZlRmxhZ3MgPT09IGdhbWUuZ2FtZUFjdGlvbi5NT1ZFX1JJR0hUKSB7XG4gICAgICAgICAgICAvLyBzcGVlZC54ICs9IHRoaXMuYWNjZWxlcmF0aW9uICogZHQ7XG4gICAgICAgICAgICAvLyBpZiAoc3BlZWQueCA+IHRoaXMubWF4U3BlZWQpIHtcbiAgICAgICAgICAgIC8vICAgICBzcGVlZC54ID0gdGhpcy5tYXhTcGVlZDtcbiAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIHNwZWVkLnggPSB0aGlzLm1heFNwZWVkO1xuICAgICAgICAgICAgdGhpcy5ub2RlLmVtaXQoXCJjaGFuZ2VEaXJlY3Rpb25cIiwgMSk7Ly/mm7TmlLnmlrnlkJFcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIGlmIChzcGVlZC54ICE9IDApIHtcbiAgICAgICAgICAgIC8vICAgICB2YXIgZCA9IHRoaXMuZHJhZyAqIGR0O1xuICAgICAgICAgICAgLy8gICAgIGlmIChNYXRoLmFicyhzcGVlZC54KSA8PSBkKSB7XG4gICAgICAgICAgICAvLyAgICAgICAgIHNwZWVkLnggPSAwO1xuICAgICAgICAgICAgLy8gICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyAgICAgICAgIHNwZWVkLnggLT0gc3BlZWQueCA+IDAgPyBkIDogLWQ7XG4gICAgICAgICAgICAvLyAgICAgfVxuICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgc3BlZWQueCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgLy8gIGNjLmxvZyhzcGVlZC54LHNwZWVkLnkpO1xuICAgICAgICBpZiAoTWF0aC5hYnMoc3BlZWQueSkgPCAxKSB7XG4gICAgICAgICAgICB0aGlzLmp1bXBzID0gMjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5qdW1wcyA+IDAgJiYgdGhpcy5fdXApIHtcbiAgICAgICAgICAgIHNwZWVkLnkgPSB0aGlzLmp1bXBTcGVlZDtcbiAgICAgICAgICAgIHRoaXMuanVtcHMtLTtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoMik7XG4gICAgICAgICAgICB0aGlzLmp1bXBpbmcgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3VwID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLmp1bXBpbmcgPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGlmIChzcGVlZC54ID4gMCB8fCBzcGVlZC54IDwgMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChzcGVlZC54ICE9IDApIHtcbiAgICAgICAgICAgIGlmIChzcGVlZC54IDwgMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5vZGUueCA8IChnYW1lLm1hcFJlY3QueCArIDE1MCkpIHtcbiAgICAgICAgICAgICAgICAgICAgc3BlZWQueCA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubm9kZS54ID4gKGdhbWUubWFwUmVjdC54ICsgZ2FtZS5tYXBSZWN0LndpZHRoIC0gMzAwKSkge1xuICAgICAgICAgICAgICAgICAgICBzcGVlZC54ID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3BlZWQueSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgc3BlZWQueSA9IDEwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2xhc3RYID0gdGhpcy5ub2RlLng7XG4gICAgICAgIHRoaXMuYm9keS5saW5lYXJWZWxvY2l0eSA9IHNwZWVkO1xuICAgIH0sXG4gICAgLy/orr7nva7op5LoibLnirbmgIFcbiAgICBzZXRTdGF0ZSh2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy5yb2xlU3RhdGUgPT0gdmFsdWUpIHJldHVybjtcbiAgICAgICAgdGhpcy5ub2RlLnJvbGVTdGF0ZSA9IHRoaXMucm9sZVN0YXRlID0gdmFsdWU7XG4gICAgICAgIHRoaXMubm9kZS5lbWl0KFwicm9sZVN0YXRlXCIsIHRoaXMucm9sZVN0YXRlKTsvL+abtOaUueWKqOS9nFxuICAgIH0sXG59KTtcbiJdfQ==